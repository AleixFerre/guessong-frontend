<div class="game-header">
  <h2>En juego</h2>
  @if (totalRounds()) {
  <span class="round-pill">Ronda {{ currentRound() }}/{{ totalRounds() }}</span>
  }
</div>
<div class="game">
  <div class="progress">
    <div class="bar" [style.width.%]="progressPercent()"></div>
  </div>
  <div class="timer">
    <span>{{ formatTime(roundDurationSec() - elapsedSeconds()) }}</span>
    <small>{{ formatRoundStatus(roundStatus()) }}</small>
  </div>
  @if (audioUnavailable()) {
  <div class="audio-warning">No hay audio disponible para esta ronda.</div>
  }
  <div class="controls">
    <button class="buzz" [disabled]="!canBuzz()" (click)="buzzRequest.emit()">PULSA</button>
  </div>
  @if (canGuess()) {
  <div class="guess">
    <input
      type="text"
      [value]="guessText()"
      (input)="guessText.set($any($event.target).value)"
      [attr.list]="guessListId"
      [placeholder]="guessTracks().length ? 'Escribe tu respuesta' : 'Cargando canciones...'"
    />
    <datalist [id]="guessListId">
      @for (track of guessTracks(); track $index) {
      <option [value]="formatGuessOption(track)"></option>
      }
    </datalist>
    <button class="primary" [disabled]="!isGuessAllowed()" (click)="sendGuess()">Enviar</button>
  </div>
  } @if (roundResult(); as result) {
  <div class="result">
    <h3>Resultado</h3>
    <p>{{ result.revealedTrackMeta.title }} â€” {{ result.revealedTrackMeta.artist }}</p>
    @if (result.winnerId) {
    <p>Puntos: {{ result.pointsAwarded }}</p>
    }
  </div>
  }
</div>
@defer (when notifications().length) {
<div class="notifications">
  @for (note of notifications(); track $index) {
  <div class="note">{{ note }}</div>
  }
</div>
} @placeholder { } @loading { } @error { }
