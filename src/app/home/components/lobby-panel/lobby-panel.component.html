@if (lobby(); as activeLobby) {
  <div class="lobby-header">
    <h2 class="lobby-title">
      <span>{{ activeLobby.name || 'Sala y puntuaciones' }}</span>
      <span class="lobby-count">{{ playersCount() }}/{{ maxPlayers() }}</span>
    </h2>
    @if (showCopyLink()) {
      <button class="ghost copy-link" (click)="copyLinkRequest.emit()">Copiar link</button>
    }
  </div>
  <div class="players">
    @for (player of sortedPlayers(); track player.id) {
      <div class="player" [class.player--active]="player.id === activeBuzzPlayerId()">
        <div class="player-info">
          <div class="player-name">
            <span
              class="player-avatar"
              [style.backgroundImage]="player.avatar ? 'url(avatars/' + player.avatar + ')' : null"
              aria-hidden="true"
            ></span>
            @if (showRanks()) {
              <span
                class="rank"
                [class.rank--leader]="$index === 0"
                [class.rank--silver]="$index === 1"
                [class.rank--bronze]="$index === 2"
              >
                #{{ $index + 1 }}
              </span>
            }
            <strong>{{ player.username }}</strong>
            @if (player.id === currentPlayerId()) {
              <span class="tag me">Yo</span>
            }
            @if (player.id === activeLobby.hostId) {
              <span class="tag">Anfitrion</span>
            }
            @if (correctPlayers()[player.id]) {
              <span class="tag success">Acert√≥</span>
            }
            @if (player.lockedForRound) {
              @if (showLockout()) {
                <span class="tag warn" [style.--lockout-duration]="lockoutDuration(player)">
                  Bloqueado
                </span>
              }
            }
          </div>
          @if (showTries() && hasGuessLimit()) {
            <div class="tries">Intentos: {{ guessLimitLabel(player) }}</div>
          }
        </div>
        @if (showScore()) {
          <div class="score">{{ player.score }}</div>
        }
      </div>
    }
  </div>

  @if (showActions()) {
    <div class="actions">
      @if (isHost()) {
        <button class="primary" (click)="startGameRequest.emit()">Empezar ronda</button>
      }
    </div>
  }
} @else {
  <p class="muted">Aun no estas en ninguna sala.</p>
}
